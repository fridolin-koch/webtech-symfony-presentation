<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Listen to the Symfony by Fridolin Koch</title>
    <!-- CSS dependencies -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/github.css">
    <link rel="stylesheet" href="assets/css/font-awesome.min.css">
    <!-- Google Fonts -->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700' rel='stylesheet' type='text/css'>
    <!-- Additional css -->
    <style>
        body {
            padding-top: 20px;
            padding-bottom: 20px;
            font-family: 'Open Sans', sans-serif;
        }
        p {
            line-height: 1.6;
        }
        a {
            font-weight: bold;
        }
        .navbar {
            margin-bottom: 20px;
        }
        .footer {
            margin-top: 20px;
            border-top: 1px solid #808080;
        }
        img {
            margin:20px 0;
        }
    </style>
</head>
<body data-spy="scroll" data-target="#navbar">
    <div class="container">
        <div class="row">
            <!-- Main content -->
            <div class="col-xs-12" role="main">

                <div class="page-header">
                    <h1>Listen to the Symfony <small>a brief introduction into Symfony2</small></h1>
                </div>

                <h2 id="section1">1. Introduction</h2>

                <p>In the first part of this tutorial I will show you how to create a very simple Issue-Tracker using the web application framework <a href="http://symfony.com/">Symfony 2</a>.
                   In the second part of this tutorial  add multi-user support to the application. The solutions for both parts of the tutorial are available on GitHub.
                    Everything is in one repository seperated by tags:<br>
                    <a href="https://github.com/fridolin-koch/tum-webtech-symfony/tree/v1.0.1">Part I (v.1.0.1)</a>
                    <a href="https://github.com/fridolin-koch/tum-webtech-symfony/tree/v2.0.0">Part II (v.1.0.2)</a>
                </p>

                <p></p>

                <p><strong>What this tutorial is about</strong><br>
                    This tutorial is about <a href="http://symfony.com/">Symfony 2</a>, <a href="http://www.doctrine-project.org/projects/orm.html">Doctrine2</a> and <a href="http://twig.sensiolabs.org/">Twig</a>.
                    The reader will learn how to implement the Model based on an UML diagram, how to create Controllers handling all the <a href="">CRUD actions</a> for </p>
                <ul>
                    <li>Setting up a environment for using Symfony</li>
                    <li>Installing and configuring Symfony</li>
                    <li>Implementing the Model using <a href="">Doctrine2</a></li>
                    <li>Implementing the Controllers</li>
                    <li>Implementing the View using <a href="">Twig</a></li>
                </ul>

                <p><strong>What this tutorial is not about</strong><br>I'll assume that you are familiar with the concepts of object oriented programming, uml, relational databases and sql because I won't cover these topics.</p>

                <hr>

                <h2 id="section2">2. Environment requirements</h2>

                <p>
                    Personally I recommend using a UNIX based system, but every OS that supports at least <a href="http://php.net/downloads.php">PHP 5.3.3</span></a> and <a href="http://dev.mysql.com/downloads/mysql/">MySQL</span></a> should be fine.
                    In this tutorial I'll assume that you are using a UNIX based system. Symfony has also some <a href="http://symfony.com/doc/current/reference/requirements.html">requirements <span class="fa fa-external-link"></span></a>, your system needs to fulfill.
                    If you are new to PHP I recommend you to use the Vagrant file from the <a href="#section21">next</a> section.
                </p>
                <!-- Vagrant -->
                <h3 id="section21">2.1 Vagrant</h3>
                <p>
                    This <a href="https://www.vagrantup.com/">Vagrant</a> file uses simple <a href="https://docs.vagrantup.com/v2/provisioning/shell.html">Shell-Provisioning</span></a> for creating a LAMP environment that works with Symfony2
                </p>
                <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span class="c1"># Vagrantfile API/syntax version. Don&#39;t touch unless you know what you&#39;re doing!</span>
<span class="no">VAGRANTFILE_API_VERSION</span> <span class="o">=</span> <span class="s2">&quot;2&quot;</span>

<span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="no">VAGRANTFILE_API_VERSION</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
<span class="c1"># All Vagrant configuration is done here. The most common configuration</span>
<span class="c1"># options are documented and commented below. For a complete reference,</span>
<span class="c1"># please see the online documentation at vagrantup.com.</span>

<span class="c1"># Every Vagrant virtual environment requires a box to build off of.</span>
<span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span> <span class="o">=</span> <span class="s2">&quot;phusion/ubuntu-14.04-amd64&quot;</span>

<span class="c1">#No Autoupdate</span>
<span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box_check_update</span> <span class="o">=</span> <span class="kp">false</span>

<span class="c1"># Create a private network, which allows host-only access to the machine</span>
<span class="c1"># using a specific IP.</span>
<span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&quot;private_network&quot;</span><span class="p">,</span> <span class="ss">ip</span><span class="p">:</span> <span class="s2">&quot;192.168.10.10&quot;</span>

<span class="c1">#set hostname</span>
<span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">hostname</span> <span class="o">=</span> <span class="s2">&quot;symfony.dev&quot;</span>

<span class="c1">#Bridge</span>
<span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span> <span class="s2">&quot;public_network&quot;</span>

<span class="c1"># Sync current folder</span>
<span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">synced_folder</span> <span class="s2">&quot;./&quot;</span><span class="p">,</span> <span class="s2">&quot;/var/www/app&quot;</span><span class="p">,</span> <span class="ss">group</span><span class="p">:</span> <span class="s2">&quot;www-data&quot;</span><span class="p">,</span> <span class="ss">owner</span><span class="p">:</span> <span class="s2">&quot;www-data&quot;</span><span class="p">,</span> <span class="ss">mode</span><span class="p">:</span> <span class="mo">0775</span>

<span class="c1">#provisioning</span>
<span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span> <span class="s2">&quot;shell&quot;</span><span class="p">,</span> <span class="ss">path</span><span class="p">:</span> <span class="s2">&quot;./provision.sh&quot;</span><span class="p">,</span> <span class="ss">privileged</span><span class="p">:</span> <span class="kp">true</span>

<span class="k">end</span>
</pre></div>
</td></tr></table>
                <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59</pre></div></td><td class="code"><div class="highlight"><pre><span class="c">#!/bin/bash</span>

<span class="nv">MYSQL_PASSWORD</span><span class="o">=</span><span class="s2">&quot;symfony2&quot;</span>

<span class="c"># update</span>
apt-get update
<span class="c"># set mysql password</span>
debconf-set-selections <span class="o">&lt;&lt;&lt;</span> <span class="s2">&quot;mysql-server mysql-server/root_password password </span><span class="si">${</span><span class="nv">MYSQL_PASSWORD</span><span class="si">}</span><span class="s2">&quot;</span>
debconf-set-selections <span class="o">&lt;&lt;&lt;</span> <span class="s2">&quot;mysql-server mysql-server/root_password_again password </span><span class="si">${</span><span class="nv">MYSQL_PASSWORD</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="c"># install dependencies</span>
apt-get install -y <span class="se">\</span>
    php5 <span class="se">\</span>
    php5-cli <span class="se">\</span>
    php5-curl <span class="se">\</span>
    php5-gd <span class="se">\</span>
    php5-memcached <span class="se">\</span>
    php5-imagick <span class="se">\</span>
    php5-imap <span class="se">\</span>
    php5-mysql <span class="se">\</span>
    php5-json <span class="se">\</span>
    php5-xsl <span class="se">\</span>
    php5-mcrypt <span class="se">\</span>
    php5-intl <span class="se">\</span>
    php5-xcache <span class="se">\</span>
    php5-mongo <span class="se">\</span>
    libssh2-php <span class="se">\</span>
    php5-mcrypt <span class="se">\</span>
    php5-intl <span class="se">\</span>
    git <span class="se">\</span>
    mysql-server <span class="se">\</span>
    apache2 <span class="se">\</span>
    libapache2-mod-php5

<span class="c">#enable mod_rewrite</span>
a2enmod rewrite
<span class="c"># configure</span>
cat <span class="o">&lt;&lt;&lt;</span> EOT &gt; /etc/apache2/sites-available/000-default.conf
&lt;VirtualHost *:80&gt;
    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/notifair/web
    &lt;Directory /var/www/notifair/web&gt;
        <span class="c"># enable the .htaccess rewrites</span>
        AllowOverride All
        Order allow,deny
        Allow from All
        &lt;/Directory&gt;
    ErrorLog <span class="si">${</span><span class="nv">APACHE_LOG_DIR</span><span class="si">}</span>/error.log
    CustomLog <span class="si">${</span><span class="nv">APACHE_LOG_DIR</span><span class="si">}</span>/access.log combined
&lt;/VirtualHost&gt;
EOT
<span class="c"># restart apache</span>
service apache2 restart

<span class="c"># prepare mysql database</span>
<span class="nb">echo</span> <span class="s2">&quot;CREATE DATABASE symfony2 CHARACTER SET utf8 COLLATE utf8_general_ci;&quot;</span> <span class="p">|</span> mysql -u root -p<span class="nv">$MYSQL_PASSWORD</span>

<span class="c"># install composer globally</span>
curl -sS https://getcomposer.org/installer <span class="p">|</span> php
mv composer.phar /usr/local/bin/composer
</pre></div>
</td></tr></table>

                <!-- Mac -->
                <h3 id="section22">2.2 PHP for OS X 10.6 to 10.10</h3>

                <p>If you are planning to install PHP native on your Mac I recommend you to use the pre-build binary packages provided by <a href="https://www.liip.ch/de">liip</a>.
                    You'll find detailed installing instruction <a href="http://php-osx.liip.ch/">here</a>.
                </p>

                <h2 id="section3">3. Setting up Symfony</h2>

                <p>Recently the Symfony team introduced the <a href="http://symfony.com/blog/introducing-the-new-symfony-installer">Symfony Installer</a> which makes it very easy to install Symfony into a certain directory:</p>
                <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="c"># Download the symfony installer</span>
sudo curl -LsS http://symfony.com/installer -o /usr/local/bin/symfony
sudo chmod a+x /usr/local/bin/symfony
<span class="c"># Create a new project</span>
symfony new projectmgr
</pre></div>
</td></tr></table>

                <p>Now we need to configure the database connection, </p>

                <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span class="c1"># This file is auto-generated during the composer install</span>
<span class="l-Scalar-Plain">parameters</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">database_driver</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">pdo_mysql</span>
    <span class="l-Scalar-Plain">database_host</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">127.0.0.1</span>
    <span class="l-Scalar-Plain">database_port</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">3306</span>
    <span class="l-Scalar-Plain">database_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">symfony2</span>
    <span class="l-Scalar-Plain">database_user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">root</span>
    <span class="l-Scalar-Plain">database_password</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">symfony2</span>
    <span class="l-Scalar-Plain">mailer_transport</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">smtp</span>
    <span class="l-Scalar-Plain">mailer_host</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">127.0.0.1</span>
    <span class="l-Scalar-Plain">mailer_user</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">null</span>
    <span class="l-Scalar-Plain">mailer_password</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">null</span>
    <span class="l-Scalar-Plain">locale</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">en</span>
    <span class="l-Scalar-Plain">secret</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">358f26d5b77ddb670676159623617a9a5bcca519</span>
</pre></div>
</td></tr></table>

                <h3 id="section33">3.3 Removing the demo code</h3>

                <p>The Symfony 2 standard edition comes with some demo code, which is useless for our purpose. So we need to remove it.</p>

                <ol>
                    <li>Delete the directory <code>src/Acme</code></li>
                    <li>Remove the reference <code>new Acme\DemoBundle\AcmeDemoBundle()</code> from the application kernel in <code>app/AppKernel.php#24</code>.</li>
                    <li>Remove the reference to the bundle in <code>app/routing_dev.yml</code></li>
                </ol>

                <h2 id="section4">4. Creating the Model</h2>

                <p>This is the uml diagram of our Model. For reasons of clarity and comprehensibility getters and setters were omitted.</p>

                <img src="assets/images/dbmodel.png" class="img-responsive">

                <p>
                    Using <a href="http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/annotations-reference.html">annotations</a> is the recommend way of defining the orm mapping.
                    Of course you can also use Yaml, XML or PHP to define the mapping information of the Doctrine entities. That said, it is the <a href="http://symfony.com/doc/current/best_practices/business-logic.html#doctrine-mapping-information">best practice approach</a> to use annotations.
                    We start by implementing the class <code>AppBundle\Entity\TaskState</code>:
                </p>
                <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">//src/AppBundle/Entity/TaskState.php</span>
<span class="k">namespace</span> <span class="nx">AppBundle\Entity</span><span class="p">;</span>

<span class="c1">//Important</span>
<span class="k">use</span> <span class="nx">Doctrine\ORM\Mapping</span> <span class="k">as</span> <span class="nx">ORM</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * @ORM\Entity</span>
<span class="sd"> * @ORM\Table(name=&quot;task_states&quot;)</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">TaskState</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @ORM\Id</span>
<span class="sd">     * @ORM\GeneratedValue(strategy=&quot;AUTO&quot;)</span>
<span class="sd">     * @ORM\Column(type=&quot;integer&quot;)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$id</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @ORM\Column(type=&quot;string&quot;)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$name</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @ORM\Column(type=&quot;string&quot;, nullable=true)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$color</span><span class="p">;</span>

    <span class="c1">// getters and setters ...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

                <p>The fields <code>$name</code> and <code>$color</code> are self-explanatory. We use the <code>@Id</code> annotation to tell Doctrine that field <code>$id</code> is our primary key.
                    Further we tell Doctrine to use the strategy <code>AUTO</code> to generate the value of <code>$id</code>. This tells Doctrine to pick the strategy that is preferred by the used database platform.
                    In our case the choose strategy would be <code>IDENTITY</code> which makes use of the <a href="https://dev.mysql.com/doc/refman/5.6/en/example-auto-increment.html">MySQL AUTO_INCREMENT</a> attribute.<br>
                    The implantation process for <code>AppBundle\Entity\TaskType</code> and <code>AppBundle\Entity\TaskPriority</code> is equivalent, so we continue with the <code>AppBundle\Entity\TaskState</code> entity.</p>

                <table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">namespace</span> <span class="nx">AppBundle\Entity</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Doctrine\Common\Collections\ArrayCollection</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\ORM\Mapping</span> <span class="k">as</span> <span class="nx">ORM</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * @ORM\Entity</span>
<span class="sd"> * @ORM\Table(name=&quot;tasks&quot;)</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">Task</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @ORM\Id</span>
<span class="sd">     * @ORM\GeneratedValue(strategy=&quot;AUTO&quot;)</span>
<span class="sd">     * @ORM\Column(type=&quot;integer&quot;)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$id</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @ORM\ManyToOne(targetEntity=&quot;TaskPriority&quot;)</span>
<span class="sd">     * @ORM\JoinColumn(name=&quot;priority_id&quot;, referencedColumnName=&quot;id&quot;, nullable=false)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$priority</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @ORM\ManyToOne(targetEntity=&quot;TaskType&quot;)</span>
<span class="sd">     * @ORM\JoinColumn(name=&quot;type_id&quot;, referencedColumnName=&quot;id&quot;, nullable=false)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$type</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @ORM\ManyToOne(targetEntity=&quot;TaskState&quot;)</span>
<span class="sd">     * @ORM\JoinColumn(name=&quot;state_id&quot;, referencedColumnName=&quot;id&quot;, nullable=false)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$state</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @ORM\ManyToOne(targetEntity=&quot;Project&quot;, inversedBy=&quot;tasks&quot;)</span>
<span class="sd">     * @ORM\JoinColumn(name=&quot;project_id&quot;, referencedColumnName=&quot;id&quot;, nullable=false, onDelete=&quot;CASCADE&quot;)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$project</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @ORM\Column(type=&quot;string&quot;)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$title</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @ORM\Column(type=&quot;text&quot;)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$description</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @ORM\Column(type=&quot;datetime&quot;)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$createDate</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @ORM\Column(type=&quot;datetime&quot;, nullable=true)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$modifiedDate</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @ORM\Column(type=&quot;datetime&quot;, nullable=true)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$dueDate</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @ORM\Column(type=&quot;integer&quot;, nullable=true)</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="nv">$timeEstimated</span><span class="p">;</span>

    <span class="c1">// getters and setters...</span>
</pre></div>
</td></tr></table>

                <p>At this point it's getting exciting since we are now defining the associations between the entities. Let's take a look at the annotations of the <code>$state</code> field.
                    The first annotation <code>@ManyToOne</code> defines a unidirectional association to the <code>TaskState</code> entity. On is internally represented by a foreign key.
                    The second annotation <code>@JoinColumn</code> defines the columns which are necessary for the join. It also defines that the task state cannot be null.
                    <code>$project</code> is the <a href="http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/unitofwork-associations.html">owning</a> side of bidirectional association.

                </p>

                <div class="alert alert-info">
                    <strong>Note</strong><br> There are many more association types which can be used.
                    The <a href="http://docs.doctrine-project.org/projects/doctrine-orm/en/latest/reference/association-mapping.html">doctrine documentation</a> is a excellent reference if you want to know more about association mapping.
                </div>

                <p>The <code>AppBundle\Entity\Project</code> entity defines the </p>

            </div>

        </div>
        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <p class="text-muted">Author Fridolin Koch 6th of April, 2015</p>
            </div>
        </footer>
    </div>
    <!-- Javascript -->
    <script src="assets/js/jquery-2.1.3.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
</body>
</html>
